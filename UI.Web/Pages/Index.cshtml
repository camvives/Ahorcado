@page
@using Microsoft.AspNetCore.Http;
@using Ahorcado.Entities;
@using IronBarCode;
@using System;
@using System.Drawing;
@using System.Linq;
@model IndexModel
@{
    ViewData["Title"] = "Ahorcado";
}

@{
    PartidaAhorcado partida = JuegoAhorcado.GetPartidaActual;
}
<div class="text-center">
    
    <div class="row mt-5">
        <div class="column mr-5">
            @if (partida.Intentos == 7)
            {
                <img id="imagen" src="./assets/0.png">
            }
            else if (partida.Intentos == 6)
            {
                <img id="imagen" src="./assets/1.png">
            }
            else if (partida.Intentos == 5)
            {
                <img id="imagen" src="./assets/2.png">
            }
            else if (partida.Intentos == 4)
            {
                <img id="imagen" src="./assets/3.png">
            }
            else if (partida.Intentos == 3)
            {
                <img id="imagen" src="./assets/4.png">
            }
            else if (partida.Intentos == 2)
            {
                <img id="imagen" src="./assets/5.png">
            }
            else if (partida.Intentos == 1)
            {
                <img id="imagen" src="./assets/6.png">
            }
            else if (partida.Intentos == 0)
            {
                <img id="imagen" src="./assets/7.png">
            }
        </div>
        @if (partida.Intentos > 0)
        {
            if (partida.Estado == PartidaAhorcado.Estados.Ganada)
            {
    <div class="column col-lg-7 hide">
        <h2 id="win" class="mt-2">¡Ganaste!</h2>
        <h3 class="mt-4 mb-3">La palabra adivinada es</h3>
        @foreach (char l in partida.PalabraAAdivinar)
        {
            <div class="d-inline p-2 bg-success text-white">@l</div>
        }
        <form class="mt-2" method="post">
            <div class="input-group mb-3 mt-5 col-lg-9 ml-5" id="nombre">
                <input type="text" class="form-control" placeholder="Ingresá tu nombre" name="Jugador" id="nombrejugador">
                <div class="input-group-append">
                    <button class="btn btn-outline-secondary" type="button" onclick="$('#beneficio').toggle();$('#nombre').toggle();">✔️</button>
                </div>
            </div>
            <div class="card" id="beneficio" style="display: none">
                <div class="card-body">
                    <div class="container">
                        <h5 class="mt-3">Escaneá el código para obtener tu beneficio:</h5>
                        <div class="row">
                            <div class="col-sm-7 mt-5">
                                <h2 class="mt-2">
                                    2x1 EN
                                </h2>
                                <h2>
                                    CINES SHOWCASE
                                </h2>
                            </div>
                            <div class="col-sm">
                                <img id="imagen" width="200" src="./assets/frame.png">
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary mb-2 mt-3 block">¡Listo!</button>

                </div>
            </div>
        </form>

    </div>
            }
            else
            {
                <div class="column col-lg-7">
                    <h3 class="mt-4 mb-3">Palabra a adivinar</h3>
                    @foreach (char l in partida.PalabraAAdivinar)
                    {
                        if (partida.LetrasAcertadas.Contains(l.ToString()))
                        {
                            <div class="d-inline p-2 bg-dark text-white">@l</div>
                        }
                        else
                        {
                            <div class="d-inline p-2 bg-dark text-white">_</div>
                        }
                    }

                    <h3 class="mt-5 mb-3">Letras Acertadas</h3>
                    @if (partida.LetrasAcertadas.Any())
                    {
                        foreach (string l in partida.LetrasAcertadas)
                        {
                            <div class="d-inline p-2 bg-info text-white">@l</div>
                        }
                    }

                    <h3 class="mt-3 mb-3">Letras incorrectas</h3>
                    @if (partida.LetrasIncorrectas.Any())
                    {
                        foreach (string l in partida.LetrasIncorrectas)
                        {
                            <div class="d-inline p-2 bg-danger text-white">@l</div>
                        }
                    }

                    <div>
                        <form class="row g-3 mt-3" asp-page-handler="letra" method="post">
                            <div class="col-auto">
                                <label for="letter" class="visually-hidden">Ingrese una letra:</label>
                            </div>
                            <div class="col-auto">
                                <input name="LetraIngresada" type="text" class="form-control" id="inputletter" placeholder="" maxlength="1" required>
                            </div>
                            <div class="col-auto">
                                <button type="submit" id="IntentarLetra" class="btn btn-primary mb-2">Intentar Letra</button>
                            </div>
                        </form>

                        <form class="row g-3 mt-1" asp-page-handler="palabra" method="post">
                            <div class="col-auto">
                                <label for="letter" class="visually-hidden">Arriesgar palabra:</label>
                            </div>
                            <div class="col-auto">
                                <input name="LetraIngresada" type="text" class="form-control" id="inputword" placeholder="" required>
                            </div>
                            <div class="col-auto">
                                <button type="submit" id="IntentarPalabra" class="btn btn-primary mb-2">Intentar Palabra</button>
                            </div>
                        </form>
                    </div>
                </div>
            }
        }
        else
        {
            <div class="column col-lg-7">
                <h2 id="lost" class="mt-5">Perdiste :(</h2>
                <h3 class="mt-4 mb-3">La palabra a adivinar era</h3>
                @foreach (char l in partida.PalabraAAdivinar)
                {
                    <div class="d-inline p-2 bg-danger text-white">@l</div>
                }
                <form class="mt-5" method="post">
                    <button type="submit" class="btn btn-primary mb-2 mt-3 block">Volver a intentar</button>
                </form>
            </div>
        }
    </div>

</div>
